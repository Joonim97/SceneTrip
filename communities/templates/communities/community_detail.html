{% extends 'base.html' %}

{% block title %}
ì»¤ë®¤ë‹ˆí‹° ê¸€ ìƒì„¸
{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2>{{ community.title }}</h2>
  <p>ì‘ì„±ì: {{ community.author.nickname }} | ì‘ì„±ì¼: {{ community.created_at }}</p>
  
  <div class="mt-4">
    <p>{{ community.content }}</p>
  </div>
  
  <!-- ì´ë¯¸ì§€ ëª©ë¡ -->
  <div class="mt-4">
    <h5>ì²¨ë¶€ ì´ë¯¸ì§€</h5>
    <div class="row">
      {% for image in community.community_images %}
      <div class="col-md-4 mb-3">
        <img src="{{ image.community_image }}" class="img-fluid" alt="community image">
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- ì¢‹ì•„ìš” / ì‹«ì–´ìš” ë²„íŠ¼ -->
  <div class="mt-4">
    <button id="like-btn" class="btn btn-outline-success">ì¢‹ì•„ìš”</button>
    <button id="dislike-btn" class="btn btn-outline-danger">ì‹«ì–´ìš”</button>
    <span>ì¢‹ì•„ìš” ìˆ˜: {{ community.community_likes.count }} | ì‹«ì–´ìš” ìˆ˜: {{ community.community_dislikes.count }}</span>
  </div>

  <div class="mt-5">
    <h5>ëŒ“ê¸€</h5>
    <div id="comments-section">
      {% for comment in community.comments %}
      <div class="comment mb-4">
        <strong>{{ comment.user.nickname }}</strong> - {{ comment.created_at }}
        <p>{{ comment.content }}</p>
        <!-- ëŒ“ê¸€ ì¢‹ì•„ìš”/ì‹«ì–´ìš” ë²„íŠ¼ -->
        <button class="btn btn-sm btn-outline-success like-comment-btn" data-comment-id="{{ comment.id }}">ğŸ‘<span>{{ comment.like_count }}</span></button>
        
        <button class="btn btn-sm btn-outline-danger dislike-comment-btn" data-comment-id="{{ comment.id }}">ğŸ‘<span>{{ comment.dislike_count }}</span></button>
        
      </div>
      {% endfor %}
    </div>
  
    <!-- ëŒ“ê¸€ ì‘ì„± í¼ -->
    <div class="mt-4">
      <h5>ëŒ“ê¸€ ì‘ì„±</h5>
      <form id="comment-form" method="POST">
        <div class="form-group">
          <textarea id="comment-content" class="form-control" rows="3" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        </div>
        <button type="submit" class="btn btn-primary mt-3">ëŒ“ê¸€ ì‘ì„±</button>
      </form>
    </div>
  </div>

<script>
  // ì¢‹ì•„ìš” ë²„íŠ¼ ë™ì‘
  document.getElementById('like-btn').addEventListener('click', function() {
    // ì¢‹ì•„ìš” ì²˜ë¦¬ ë¡œì§ ì¶”ê°€
    alert("ì¢‹ì•„ìš” í´ë¦­ë¨");
  });

  // ì‹«ì–´ìš” ë²„íŠ¼ ë™ì‘
  document.getElementById('dislike-btn').addEventListener('click', function() {
    // ì‹«ì–´ìš” ì²˜ë¦¬ ë¡œì§ ì¶”ê°€
    alert("ì‹«ì–´ìš” í´ë¦­ë¨");
  });

  // ëŒ“ê¸€ ì‘ì„± ì²˜ë¦¬
  document.getElementById('comment-form').addEventListener('submit', function(event) {
    event.preventDefault();
    const commentContent = document.getElementById('comment-content').value;
    const communityId = "{{ community.id }}";
    const accessToken = localStorage.getItem('access_token');
    
    fetch(`/api/communities/${communityId}/comments/`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${accessToken}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ content: commentContent })
    })
    .then(response => response.json())
    .then(data => {
      alert('ëŒ“ê¸€ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
      location.reload(); // ëŒ“ê¸€ ì‘ì„± í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
    })
    .catch(error => {
      console.error('ëŒ“ê¸€ ì‘ì„± ì¤‘ ì—ëŸ¬ ë°œìƒ:', error);
      alert('ëŒ“ê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    });
  });

  // ëŒ“ê¸€ ì¢‹ì•„ìš”/ì‹«ì–´ìš” ë²„íŠ¼ ì²˜ë¦¬
  document.querySelectorAll('.like-comment-btn').forEach(button => {
    button.addEventListener('click', function() {
      const commentId = button.getAttribute('data-comment-id');
      fetch(`/api/communities/comments/${commentId}/like/`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
        },
      })
      .then(response => response.json())
      .then(data => {
        alert('ì¢‹ì•„ìš” ì²˜ë¦¬ ì™„ë£Œ');
        location.reload(); // ì¢‹ì•„ìš” ì²˜ë¦¬ í›„ ìƒˆë¡œê³ ì¹¨
      });
    });
  });

  document.querySelectorAll('.dislike-comment-btn').forEach(button => {
    button.addEventListener('click', function() {
      const commentId = button.getAttribute('data-comment-id');
      fetch(`/api/communities/comments/${commentId}/dislike/`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
        },
      })
      .then(response => response.json())
      .then(data => {
        alert('ì‹«ì–´ìš” ì²˜ë¦¬ ì™„ë£Œ');
        location.reload(); // ì‹«ì–´ìš” ì²˜ë¦¬ í›„ ìƒˆë¡œê³ ì¹¨
      });
    });
  });
</script>

{% endblock %}
