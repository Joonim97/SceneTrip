<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>카카오 로그인</title>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js"
        integrity="sha384-TiCUE00h649CAMonG018J2ujOgDKW/kVWlChEuu4jK2vxfAAD0eZxzCKakxg55G4" crossorigin="anonymous">
    </script>
    <style>
        /* 페이지 전체에 대한 스타일 */
        body, html {
            height: 100%;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f5f5f5;
        }

        /* 버튼을 감싸는 컨테이너 스타일 */
        .login-container {
            width: 350px;
            padding: 40px;
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        /* 카카오 로그인 버튼 중앙에 */
        #kakao-login-btn img {
            width: 75%;
            height: auto;
            cursor: pointer;
        }

        /* 로그인 결과 텍스트 */
        #token-result {
            margin-top: 20px;
            font-size: 14px;
            color: #333;
        }
    </style>
    <script>
        Kakao.init('{{KAKAO_JAVA_SCRIPTS_API_KEY}}'); // 사용하려는 앱의 JavaScript 키 입력

        function loginWithKakao() {
            Kakao.Auth.authorize({
                redirectUri: 'http://127.0.0.1:8000/api/accounts/social/callback/kakao/', // 자신의 URI로 수정
            });
        }

        // 아래는 데모를 위한 UI 코드입니다.
        displayToken()
        function displayToken() {
            var access_token = getCookie('authorize-access-token');

            if(access_token) {
                Kakao.Auth.setAccessToken(access_token);
                Kakao.Auth.getStatusInfo()
                    .then(function(res) {
                        if (res.status === 'connected') {
                            document.getElementById('token-result').innerText
                                = 'login success, token: ' + Kakao.Auth.getAccessToken();
                                window.location.href = "/"
                        }
                    })
                    .catch(function(err) {
                        Kakao.Auth.setAccessToken(null);
                    });
            }
        }

        function getCookie(name) {
            let cookieArr = document.cookie.split(";");
            for (let i = 0; i < cookieArr.length; i++) {
                let cookiePair = cookieArr[i].split("=");
                if (name == cookiePair[0].trim()) {
                    return decodeURIComponent(cookiePair[1]);
                }
            }
            const accessToken = getCookie('access_token');
            if (accessToken) {
                localStorage.setItem('access_token', accessToken);
            }
            return null;

            async function fetchProtectedResource() {
                const response = await fetch('/api/protected/resource/', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${accessToken}` // 쿠키의 액세스 토큰 사용
                    }
                });
            
                if (response.ok) {
                    const data = await response.json();
                    console.log(data);
                } else {
                    console.error('Failed to fetch protected resource', response.statusText);
                }
}
        //    var parts = document.cookie.split(name + '=');
        //    if (parts.length === 2) { return parts[1].split(';')[0]; }
        }
    </script>
</head>
<body>
    <div class="login-container">
    <h1>카카오 로그인</h1>
    <a id="kakao-login-btn" href="javascript:loginWithKakao()">
        <img src="https://k.kakaocdn.net/14/dn/btroDszwNrM/I6efHub1SN5KCJqLm1Ovx1/o.jpg" width="222" 
            alt="카카오 로그인 버튼" />
    </a>
    <p id="token-result"></p>
</div>
</body>
</html>
