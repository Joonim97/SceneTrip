{% extends 'base.html' %}

{% block title %}
로그인
{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2>로그인</h2>
  <form id="login-form" method="POST">
    <div class="mb-3">
      <label for="user_id" class="form-label">아이디</label>
      <input type="text" class="form-control" id="user_id" name="user_id" required>
    </div>
    <div class="mb-3">
      <label for="password" class="form-label">비밀번호</label>
      <input type="password" class="form-control" id="password" name="password" required>
    </div>
    <button type="submit" class="btn btn-primary">로그인</button>
    <br><br><br>
    <hr>
    <a href="{% url 'accounts:kakaologinpage' %}" class="kakao-login-btn">카카오 계정으로 로그인하기</a>
  </form>

  <style>
    .kakao-login-btn {
      display: inline-block;
      background-color: #f9e000; /* Kakao's official yellow */
      color: black; /* Text color */
      padding: 15px 30px; /* Padding to make it look like a button */
      border-radius: 25px; /* Rounded corners */
      border: 0px solid black; /* Optional: border for emphasis */
      text-decoration: none; /* Remove underline */
      font-weight: bold; /* Make the text bold */
      font-size: 16px; /* Adjust font size */
      text-align: center;
  }
  
    .kakao-login-btn:hover {
        background-color: #FDDC00; /* Slightly darker yellow on hover */
        cursor: pointer; /* Hand cursor on hover */
    }
  </style>
  <script>
    document.getElementById('login-form').addEventListener('submit', function(event) {
      event.preventDefault();  // 기본 폼 제출 막기

      // 사용자 입력 값 가져오기
      const userId = document.getElementById('user_id').value;
      const password = document.getElementById('password').value;

      // 디버깅을 위해 입력값 콘솔에 출력
      console.log("User ID:", userId, "Password:", password);

      // POST 요청을 보냄
      fetch("{% url 'accounts:token_obtain_pair' %}", {
        method: "POST",
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          user_id: userId,
          password: password
        })
      }).then(response => {
        if (!response.ok) {
          throw new Error('네트워크 응답에 문제가 있습니다.');
        }
        return response.json();
      }).then(data => {
        if (data.access) {
          // JWT 토큰을 로컬 스토리지에 저장
          localStorage.setItem('access_token', data.access);
          localStorage.setItem('refresh_token', data.refresh);

          // 메인 페이지로 리다이렉트
          window.location.href = "{% url 'index' %}";
        } else {
          alert('로그인 실패: ' + (data.detail || '아이디 또는 비밀번호를 확인하세요.'));
        }
      }).catch(error => {
        console.error('로그인 요청 중 에러 발생:', error);
      });
    });
  </script>
</div>
{% endblock %}
